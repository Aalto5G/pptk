#include "iphdr.h"

int main(int argc, char **argv)
{
  char tcp6plain[] = "\x60\x0\x0\x0\x0\x17\x6\x40\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x0\x14\x0\x50\x0\x0\x0\x0\x0\x0\x0\x0\x50\x2\x20\x0\xba\xa\x0\x0\x66\x6f\x6f";
  char tcp6frag[] = "\x60\x0\x0\x0\x0\x1f\x2c\x40\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x6\x0\x0\x0\x0\x0\x0\x0\x0\x14\x0\x50\x0\x0\x0\x0\x0\x0\x0\x0\x50\x2\x20\x0\xba\xa\x0\x0\x66\x6f\x6f";
  char tcp6hop[] = "\x60\x0\x0\x0\x0\x1f\x0\x40\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x6\x0\x1\x4\x0\x0\x0\x0\x0\x14\x0\x50\x0\x0\x0\x0\x0\x0\x0\x0\x50\x2\x20\x0\xba\xa\x0\x0\x66\x6f\x6f";
  char tcp6subsequentfrag[] = "\x60\x0\x0\x0\x0\x1f\x2c\x40\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x1\x6\x0\x0\x8\x0\x0\x0\x0\x0\x14\x0\x50\x0\x0\x0\x0\x0\x0\x0\x0\x50\x2\x20\x0\xba\xa\x0\x0\x66\x6f\x6f";
  uint8_t proto;
  char *tcp, *frag;

  tcp = ipv6_proto_hdr(tcp6plain, &proto);
  if (proto != 6)
  {
    abort();
  }
  if (memcmp(tcp + 20, "foo", 3) != 0)
  {
    abort();
  }

  tcp = ipv6_proto_hdr(tcp6frag, &proto);
  if (proto != 6)
  {
    abort();
  }
  if (memcmp(tcp + 20, "foo", 3) != 0)
  {
    abort();
  }

  frag = ipv6_proto_hdr(tcp6subsequentfrag, &proto);
  if (proto != 44)
  {
    abort();
  }
  if (ipv6_frag_off(frag) != 8)
  {
    abort();
  }
  if (ipv6_more_frags(frag))
  {
    abort();
  }

  tcp = ipv6_proto_hdr(tcp6hop, &proto);
  if (proto != 6)
  {
    abort();
  }
  if (memcmp(tcp + 20, "foo", 3) != 0)
  {
    abort();
  }

  return 0;
}
