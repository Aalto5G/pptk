#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include "chacha.h"


int main(int argc, char **argv)
{
  char key[32] = {(char)0x00,(char)0x01,(char)0x02,(char)0x03,(char)0x04,(char)0x05,(char)0x06,(char)0x07,(char)0x08,(char)0x09,(char)0x0a,(char)0x0b,(char)0x0c,(char)0x0d,(char)0x0e,(char)0x0f,(char)0x10,(char)0x11,(char)0x12,(char)0x13,(char)0x14,(char)0x15,(char)0x16,(char)0x17,(char)0x18,(char)0x19,(char)0x1a,(char)0x1b,(char)0x1c,(char)0x1d,(char)0x1e,(char)0x1f};
  uint32_t counter = 1;
  char nonce[12] = {(char)0x00,(char)0x00,(char)0x00,(char)0x09,(char)0x00,(char)0x00,(char)0x00,(char)0x4a,(char)0x00,(char)0x00,(char)0x00,(char)0x00};
  char out[64];
  int i;
  char expected_out[64] = {
(char)0x10,(char)0xf1,(char)0xe7,(char)0xe4,(char)0xd1,(char)0x3b,(char)0x59,(char)0x15,(char)0x50,(char)0x0f,(char)0xdd,(char)0x1f,(char)0xa3,(char)0x20,(char)0x71,(char)0xc4,
(char)0xc7,(char)0xd1,(char)0xf4,(char)0xc7,(char)0x33,(char)0xc0,(char)0x68,(char)0x03,(char)0x04,(char)0x22,(char)0xaa,(char)0x9a,(char)0xc3,(char)0xd4,(char)0x6c,(char)0x4e,
(char)0xd2,(char)0x82,(char)0x64,(char)0x46,(char)0x07,(char)0x9f,(char)0xaa,(char)0x09,(char)0x14,(char)0xc2,(char)0xd7,(char)0x05,(char)0xd9,(char)0x8b,(char)0x02,(char)0xa2,
(char)0xb5,(char)0x12,(char)0x9c,(char)0xd1,(char)0xde,(char)0x16,(char)0x4e,(char)0xb9,(char)0xcb,(char)0xd0,(char)0x83,(char)0xe8,(char)0xa2,(char)0x50,(char)0x3c,(char)0x4e,
};
  struct chacha20_ctx ctx;
  chacha20_block(key, counter, nonce, out);
  if (memcmp(out, expected_out, 64) != 0)
  {
    abort();
  }
  for (i = 0; i < 1000*1000; i++)
  {
    chacha20_block(key, ++counter, nonce, out); // 0.2 us per invocation
    if (memcmp(out, expected_out, 64) == 0)
    {
      abort();
    }
  }
  if (chacha20_init_devrandom(&ctx) != 0)
  {
    abort();
  }
  return 0;
}
